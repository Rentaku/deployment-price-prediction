import os
os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'

import tensorflow as tf
from tensorflow import keras
import pandas
import numpy as np
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_squared_error, mean_absolute_error, r2_score
from flask import Flask, request, jsonify

class RSquared(tf.keras.metrics.Metric):
    def __init__(self, name='r_squared', **kwargs):
        super(RSquared, self).__init__(name=name, **kwargs)
        self.total_residual = self.add_weight(name='total_residual', initializer='zeros')
        self.total_total = self.add_weight(name='total_total', initializer='zeros')

    def update_state(self, y_true, y_pred, sample_weight=None):
        residual = tf.reduce_sum(tf.square(tf.subtract(y_true, y_pred)))
        total = tf.reduce_sum(tf.square(tf.subtract(y_true, tf.reduce_mean(y_true))))
        self.total_residual.assign_add(residual)
        self.total_total.assign_add(total)

    def result(self):
        r2_score = 1 - tf.math.divide_no_nan(self.total_residual, self.total_total)
        return r2_score

    def reset_states(self):
        self.total_residual.assign(0.0)
        self.total_total.assign(0.0)
list_fitur = ['mileage', 'ASTON MARTIN', 'BMW', 'CADILLAC', 'CHEVROLET', 'CHRYSLER', 'DAIHATSU', 'FORD', 'HONDA', 'HYUNDAI', 'ISUZU', 'JAGUAR', 'JEEP', 'KIA', 'LAND ROVER', 'LEXUS', 'MAZDA', 'MERCEDES-BENZ', 'MG', 'MINI', 'MITSUBISHI', 'NISSAN', 'PEUGEOT', 'PORSCHE', 'RENAULT', 'SKODA', 'SSANGYONG', 'SUBARU', 'SUZUKI', 'TOYOTA', 'VOLKSWAGEN', '1000', '114', '116', '116 %::&5', '116 i', '118', '118 2,0', '118 M-sport LCI', '120', '128', '128 3,0', '128 M tech', '130', '1300', '135', '1500', '1500,1600 Schtufenheck', '200', '207', '220', '230', '250', '270', '280', '3  TF 135', '300', '300 LIMITED', '300 S', '300 c', '300 გაცვლა', '3008', '301', '308', '316', '316 i', '318', '318 i', '320', '320 2 vanusi', '320 2.0', '320 Diesel', '320 Gran Turismo', '320 I', '320 I XDRIVE', '320 M3 Bodykit', '320 XI', '320 i', '323', '323 JAPAN', '325', '325 CI', '325 E46', '325 XI', '325 i', '328', '328 2.0', '328 2.8', '328 3.0', '328 330', '328 DIZEL', '328 F30', '328 M package', '328 Xdrive', '328 f30', '328 i', '328 sulev ', '330', '330 3.0', '330 330', '335', '335 3.0', '335 335i', '335 D', '335 M', '335 M paket', '335 XI E90', '335 ტურბო', '370Z Z34', '407', '416', '420', '428', '428 M4', '428 Sport Line', '428 i', '435', '4Runner', '4Runner SR5', '500', '508', '520', '520 2.2', '520 d xDrive Luxury', '523', '525', '525 2.5turbo', '525 525', '525 M-PAKET', '525 i', '528', '528 2,0', '528 2.0 ტურბო', '528 3,0', '528 3.0', '528 F10', '528 I', '528 M Pack', '528 i', '530', '530 2 vanusi ', '530 525i', '530 530', '530 E60', '530 GT', '530 I', '530 M', '530 M paket', '535', '535 535', '535 ActiveHybrid 5 ', '535 F10', '535 I', '535 M PAKET', '535 M5', '535 Turbo', '535 Twinturbo', '535 XI', '535 comfort-sport', '535 hybrid', '535 i', '535 i xDrive', '535 xi', '540', '545', '550', '550 F10', '550 GT', '550 M Packet', '550 gt', '640', '645', '645 CI', '645 Ci', '650', '730', '730 3.0', '735', '740', '740 i', '745', '745 i', '750', '750 4.8', '750 ALPINA B7', '750 L Japan', '750 LI', '911', 'A 140', 'A 170', 'A 200', 'ASX', 'ATS', 'ATS LUXURY', 'Accent', 'Accent GLS', 'Accent GS', 'Accent SE', 'Accord', 'Accord Coupe V6 Premium', 'Actyon', 'Airtrek', 'Airwave', 'Allante', 'Alphard', 'Altezza', 'Altima', 'Aqua', 'Aqua  S LADY', 'Aqua 2013', 'Aqua 2014', 'Aqua 2015', 'Aqua G', 'Aqua G ', 'Aqua G PAKETI', 'Aqua HIBRID', 'Aqua L paketi', 'Aqua S', 'Aqua Trd sporti', 'Aqua aqua', 'Aqua g soft leather sele', 'Aqua s', 'Aqua sport', 'Aqua სასწრაფოდ', 'Aqua ჰიბრიდი', 'Armada', 'Atenza', 'Auris', 'Avalon', 'Avalon 12/12', 'Avalon Hybrid', 'Avalon LIMITED', 'Avalon LIMITED ', 'Avalon Limited', 'Avalon limited', 'Avella', 'Avensis', 'Aveo', 'Axela', 'Axiom', 'Azera', 'B 170', 'B 170 ELEGANSI', 'B 170 Edition One', 'B 180', 'B 200', 'B 200 Turbo', 'B9 Tribeca', 'BRZ', 'Belta', 'Blade', 'Boxster', 'C 180', 'C 180 komp', 'C 180 კომპრესორი', 'C 200', 'C 200 KOMPRESOR', 'C 200 Kompressor', 'C 220', 'C 220 d Premium', 'C 230', 'C 230 2.5', 'C 230 kompresor', 'C 240', 'C 240 w203', 'C 250', 'C 250 1,8 turbo', 'C 250 1.8', 'C 250 1.8 turbo AMG', 'C 250 1.8 ტურბო', 'C 250 AMG', 'C 250 AMG-PAKET-1,8', 'C 250 Amg', 'C 250 BLUEFIENCE', 'C 250 W204', 'C 250 luxury', 'C 270', 'C 270 CDI', 'C 280', 'C 280 2.996', 'C 30 AMG', 'C 300', 'C 300 300', 'C 300 4 Matic', 'C 300 4matic', 'C 300 AMG', 'C 300 sport', 'C 32 AMG', 'C 320', 'C 320 AMG', 'C 320 CDI', 'C 350', 'C 350 3.7', 'C 55 AMG', 'C 63 AMG', 'C-MAX', 'C-MAX 2.0', 'C-MAX C-MAX', 'C-MAX HYBRID', 'C-MAX Hybrid', 'C-MAX PREMIUM', 'C-MAX Plug in ', 'C-MAX SE', 'C-MAX SEL', 'C-MAX Se', 'C-MAX Titanium', 'C-MAX plug-in', 'C-MAX sel', 'C-MAX დატენვადი ჰიბრიდი', 'CC', 'CC 2.0 T', 'CC R line', 'CC r line', 'CC sport', 'CHR', 'CHR Limited', 'CL 500', 'CL 55 AMG KOMPRESSOR', 'CL 550', 'CL 600', 'CL550 AMG', 'CLA 200', 'CLA 250', 'CLA 250 2,0', 'CLA 250 AMG', 'CLA 250 AMG ', 'CLK 220', 'CLK 240', 'CLK 270', 'CLK 280', 'CLK 320', 'CLK 320 AMG', 'CLK 320 w209', 'CLK 350', 'CLK 500', 'CLK 55 AMG', 'CLS 320', 'CLS 350', 'CLS 350 AMG', 'CLS 350 JAPAN', 'CLS 500', 'CLS 500 AMG', 'CLS 55 AMG', 'CLS 55 AMG Kompressor', 'CLS 550', 'CLS 550 550', 'CLS 550 AMG', 'CLS 63 AMG', 'CLS 63 AMG Amg', 'CR-Z', 'CR-Z MT', 'CR-Z ჰიბრიდი', 'CT 200h', 'CT 200h 1.8', 'CT 200h F SPORT', 'CT 200h F sport', 'CT 200h F-sport', 'CT 200h ჰიბრიდი', 'CTS', 'CTS BLS', 'CX-3', 'CX-3 Grand tauring', 'CX-5', 'CX-5 SPORT', 'CX-5 Touring', 'CX-7', 'CX-7 MZR', 'CX-9', 'Caddy', 'Caddy maxi', 'Cadenza', 'Caldina', 'Camaro', 'Camaro 2lt', 'Camaro LS', 'Camaro RS', 'Camry', 'Camry 55', 'Camry 87000', 'Camry HIBRID', 'Camry HIBRYD', 'Camry HYBRID', 'Camry Hybrid', 'Camry Hybrid XLE', 'Camry LE', 'Camry Le', 'Camry S', 'Camry SE', 'Camry SE   HIBRYD ', 'Camry SE  SPORT', 'Camry SEDAN', 'Camry SPORT', 'Camry SPORT PAKET', 'Camry Se', 'Camry Sport', 'Camry TOYOTA', 'Camry V70', 'Camry XL', 'Camry XLE', 'Camry XLE HYBRID', 'Camry XLEi', 'Camry XSE', 'Camry XV50', 'Camry hybrid', 'Camry limited', 'Camry scion tc', 'Camry se', 'Camry sel', 'Camry sport', 'Camry sport se', 'Camry sporti', 'Camry xle', 'Camry ჰიბრიდი', 'Captiva', 'Captur', 'Captur QM3 Samsung', 'Carnival', 'Carnival grand', 'Cayenne', 'Cayenne S', 'Cayenne s', 'Cayman', 'Ceed', 'Cerato', 'Cerato K3', 'Cherokee', 'Citan', 'Civic', 'Civic EX', 'Civic EXL', 'Civic Hybrid', 'Civic Hybrid ', 'Civic Hybrid L', 'Civic LX', 'Civic coupe', 'Civic crz', 'Clarity', 'Clio', 'Clubman', 'Clubman S', 'Colt', 'Commander', 'Compass', 'Compass Latitude', 'Cooper', 'Cooper F-56', 'Cooper John Cooper. work', 'Cooper S', 'Cooper S ', 'Cooper S Cabrio', 'Cooper S Cabrio R56', 'Cooper s', 'Cooper სასწრაფოდ', 'Corolla', 'Corolla 04', 'Corolla 140', 'Corolla AXIO HYBRID', 'Corolla ECO', 'Corolla Europa', 'Corolla FIELDER', 'Corolla IM', 'Corolla Im', 'Corolla LE', 'Corolla S', 'Corolla YARIS IA', 'Corolla se', 'Corvette', 'Countryman', 'Countryman One', 'Countryman S', 'Countryman S ALL4', 'Countryman S turbo', 'Countryman s', 'Countryman sport', 'Courier', 'Cr-v', 'Cr-v EXL', 'Cr-v LX', 'Crafter', 'Crafter 2,5TDI', 'Creta', 'Crossfire', 'Crossroad', 'Crosstour', 'Crosstrek', 'Crosstrek xv', 'Cruze', 'Cruze Diesel', 'Cruze L T', 'Cruze LIMITED LT2', 'Cruze LS', 'Cruze LT', 'Cruze LT RS', 'Cruze LT RS 2014', 'Cruze LTZ', 'Cruze PREMIER', 'Cruze Premer', 'Cruze Premier', 'Cruze RS', 'Cruze RS LT', 'Cruze Sonic', 'Cruze cruze', 'Cruze ltz', 'Cruze sonic ', 'Cruze strocna', 'DTS', 'Daimler', 'Defender 110', 'Delica', 'Delica 4x4', 'Delica 5', 'Delica D5', 'Discovery', 'Discovery 2', 'Discovery 3', 'Discovery IV', 'Discovery LR3', 'Duster', 'E 200', 'E 200 CGI ', 'E 200 W212', 'E 200 cdi', 'E 220', 'E 220 211', 'E 220 C', 'E 220 CDI', 'E 220 ELEGANCE', 'E 220 W210...CDI', 'E 220 cdi', 'E 240', 'E 240 260', 'E 250', 'E 250 BLUTECH', 'E 260', 'E 270', 'E 270 4', 'E 270 AVANGARDI', 'E 270 elegance', 'E 280', 'E 280 3.0', 'E 280 CDI', 'E 280 avangardi', 'E 300', 'E 300 AVANTGARDE-LTD ', 'E 300 Bluetec', 'E 300 w211', 'E 320', 'E 320 211', 'E 320 3.2', 'E 320 4matic', 'E 320 4×4', 'E 320 Avantgarde', 'E 320 CDI', 'E 320 bluetec', 'E 320 cdi', 'E 350', 'E 350 212', 'E 350 3.0', 'E 350 4 MATIC', 'E 350 4 Matic', 'E 350 4 Matic AMG Packag', 'E 350 4 matic', 'E 350 4MATIC', 'E 350 AMG', 'E 350 AMG EDITION', 'E 350 AMG Pack', 'E 350 Amg', 'E 350 BLUETEC', 'E 350 CDI 4 MATIC', 'E 350 CGI', 'E 350 amg', 'E 350 w211', 'E 350 ამგ', 'E 400', 'E 430', 'E 430  AVANTGARDE ', 'E 50', 'E 500', 'E 500 AMG', 'E 500 AVG', 'E 55', 'E 550', 'ES 300', 'ES 300 HIBRID', 'ES 300 Hibrid', 'ES 300 hybrid', 'ES 350', 'Eclipse', 'Eclipse ES', 'Eclipse SE', 'EcoSport', 'EcoSport SE', 'Edge', 'Edix', 'Edix FR-v', 'Elantra', 'Elantra .', 'Elantra 1.8', 'Elantra 10', 'Elantra 2012', 'Elantra 2014', 'Elantra 2016', 'Elantra Avante', 'Elantra GLS', 'Elantra GLS / LIMITED', 'Elantra GS', 'Elantra GT', 'Elantra Gt', 'Elantra LIMITED', 'Elantra LIMITEDI', 'Elantra Limited', 'Elantra Limited ', 'Elantra Limitedi', 'Elantra RESTAYLING', 'Elantra SE', 'Elantra Se', 'Elantra TOURING', 'Elantra gt', 'Elantra i30', 'Elantra limited', 'Elantra se', 'Elantra sport limited', 'Elantra კუპე', 'Elantra ლიმიტედი', 'Element', 'Elgrand', 'Elgrand 4x4', 'Elgrand VIP CLASS', 'Elysion', 'Eos', 'Equinox', 'Equinox LT', 'Equinox lt', 'Escalade', 'Escape', 'Escape 3', 'Escape 3.0', 'Escape HYBRID', 'Escape Hybrid', 'Escape LIMITED', 'Escape Limited', 'Escape Limuted4x4', 'Escape SE', 'Escape TITAN', 'Escape TITANIIUM', 'Escape TITANIUM', 'Escape Titanium', 'Escape XLT', 'Escape escape', 'Escape limited', 'Escape მერკური მერინერი', 'Escort', 'Espace', 'Estima', 'Estima hibrid', 'Every Landy NISSAN SEREN', 'Expedition', 'Explorer', 'Explorer EDIBAUER', 'Explorer Turbo japan', 'Explorer XLT', 'F-pace', 'F150', 'F250 superduty', 'FIT', 'FIT "S"- PAKETI.', 'FIT F', 'FIT GP-5', 'FIT GP-6', 'FIT HYBRYD', 'FIT Hbrid', 'FIT Hibrid', 'FIT Hybrid', 'FIT LX', 'FIT PORT', 'FIT PREMIUM', 'FIT RS', 'FIT RS Hybrid', 'FIT RS MODELI', 'FIT RS MUGEN', 'FIT S', 'FIT SHUTTLE', 'FIT SHUTTLE ', 'FIT SPORT', 'FIT Sport', 'FIT ex', 'FIT hybrid', 'FIT rs', 'FIT sport', 'FIT sport ( RS )', 'FIT sporti', 'FJ Cruiser', 'Fabia', 'Fiesta', 'Fiesta 1.6', 'Fiesta SE', 'Fiesta Titanium', 'Fiesta se', 'Focus', 'Focus Flexfuel', 'Focus PLUG-IN TITANIUM', 'Focus SE', 'Focus SEL', 'Focus ST', 'Focus Se', 'Focus TITANIUM', 'Focus Titanium', 'Focus es', 'Focus se', 'Focus sel', 'Focus titanium', 'Forester', 'Forester 2.0XT (TURBO)', 'Forester 4x4', 'Forester CrossSport', 'Forester L.L.BEAN', 'Forester LIMITED', 'Forester Limited', 'Forester PREMIUM', 'Forester XT', 'Forester cross sport', 'Forester legacy', 'Forester touring', 'Forte', 'Forte 1.8 პრასტოი', 'Fortuner', 'Fred', 'Fred HIBRIDI', 'Frontier', 'Frontier 2002', 'Frontier PRO-4X', 'Fuga', 'Fusion', 'Fusion 1.6', 'Fusion 2.5', 'Fusion 2015', 'Fusion Bybrid', 'Fusion Ecoboost', 'Fusion HIBRID', 'Fusion HYBRID', 'Fusion HYBRID SE', 'Fusion Hybrid', 'Fusion PLAGIN', 'Fusion PLUG IN', 'Fusion S', 'Fusion SE', 'Fusion SE HYBRID ', 'Fusion Se', 'Fusion Se ekoboost', 'Fusion TITANIUM', 'Fusion TITANIUM PHEV', 'Fusion TITANIUMI', 'Fusion Titanium', 'Fusion energi', 'Fusion hybrid', 'Fusion phev', 'Fusion s', 'Fusion se', 'Fusion titanium', 'Fusion ჰიბრიდი', 'G 550', 'GL 320', 'GL 320 CDI', 'GL 320 bluetec', 'GL 350', 'GL 350 BLUTEC', 'GL 350 Bluetec', 'GL 350 bluetec', 'GL 350 დიზელი', 'GL 450', 'GL 450 4MATIC', 'GL 500', 'GL 550', 'GL 550 AMG', 'GLA 200', 'GLA 250', 'GLA 250 4 MATIC', 'GLA 250 4MATIC', 'GLC 250', 'GLE 350', 'GLK 250', 'GLK 300', 'GLK 320', 'GLK 350', 'GLS 350', 'GS 300', 'GS 350', 'GS 430', 'GS 450', 'GS 450 hybrid', 'GTI', 'GTI 2,0T', 'GTI Jetta', 'GTI golf-6', 'GX 460', 'GX 470', 'GX 470 470', 'GX 470 GX470', 'GX 470 KDSS', 'GX 470 SUV 4D (4.7L V8 S', 'Genesis', 'Golf', 'Golf 6', 'Golf 7', 'Golf R', 'Golf TDI', 'Grand Cherokee', 'Grand Cherokee LAREDO', 'Grand Cherokee SRT.8', 'Grand Cherokee SRT8', 'Grand Cherokee limited', 'Grand Cherokee overlend', 'Grand Cherokee special e', 'Grand HIACE', 'Grand Vitara', 'Grand Vitara Nomade', 'Grandeur', 'Grandis', 'H1', 'H1 GRAND STAREX', 'H1 grandstarex', 'H1 starixs', 'HS 250h', 'HS 250h HYBRID', 'HS 250h Hybrid', 'HS 250h LIMITED', 'HS 250h შშ', 'HUSTLER', 'Harrier', 'Hiace', 'Highlander', 'Highlander 2,4', 'Highlander 2,4  4 cil', 'Highlander 2.4 lit', 'Highlander BASE', 'Highlander HYBRID', 'Highlander LIMITED', 'Highlander LIMITED ', 'Highlander XLE', 'Highlander limited', 'Highlander sport', 'Hilux', 'Hilux D4D', 'Hilux Surf', 'Hr-v', 'Hr-v EX', 'Hr-v EXL', 'I IO', 'I30', 'IS 200', 'IS 250', 'IS 250 TURBO', 'IS 250 რესტაილინგი', 'IS 300', 'IS 350', 'IS 350 C', 'IS-F', 'ISIS', 'IX35', 'IX35 2.0', 'Impala', 'Impreza', 'Impreza G4', 'Impreza Sport ', 'Impreza WRX NBR', 'Impreza WRX/STI LIMITED', 'Insight', 'Insight EX', 'Insight HYBRID', 'Insight LX', 'Insight TOURING', 'Ipsum', 'Ipsum Restailing', 'Ipsum S', 'Ist', 'Ist 1.5', 'Ist scion-IST', 'Jazz', 'Jetta', 'Jetta 1.4  TURBO', 'Jetta 2.5 SE', 'Jetta 2012', 'Jetta GLI', 'Jetta R-line', 'Jetta S', 'Jetta SE', 'Jetta SEL', 'Jetta SPORT', 'Jetta Sport', 'Jetta TDI', 'Jetta TSI', 'Jetta hybrid', 'Jetta s', 'Jetta se', 'Jetta sei', 'Jetta sel', 'Jetta sport', 'Jetta სასწაფოდ', 'Jetta სპორტ', 'Jimny', 'Juke', 'Juke 2015', 'Juke AWD', 'Juke Juke', 'Juke NISMO', 'Juke Nismo', 'Juke Nismo RS', 'Juke Rastailingi', 'Juke S', 'Juke SV AWD', 'Juke juke', 'Juke nismo', 'Kangoo', 'Kangoo Waggon', 'Kicks', 'Kicks SR', 'Kicks SR-line', 'Kicks SV', 'Kizashi', 'Kizashi sporti', 'Korando', 'Kuga TITANIUM', 'Kyron', 'L 200', 'LR2', 'LS 460', 'LT', 'LT 46', 'LX 470', 'LX 570', 'Lacetti', 'Lancer', 'Lancer 10', 'Lancer ES', 'Lancer GT', 'Lancer GTS', 'Land Cruiser', 'Land Cruiser 100', 'Land Cruiser 105', 'Land Cruiser 11', 'Land Cruiser PRADO', 'Land Cruiser Prado', 'Land Cruiser Prado prado', 'Land Rover Sport', 'Lantra', 'Lantra LIMITED', 'Leaf', 'Leaf 30 კვტ', 'Leaf AERO-paket!!!', 'Leaf AZ0', 'Leaf SL', 'Legacy', 'Legacy LIMITED', 'Legacy Limited', 'Liberty', 'Liberty KK', 'Liberty limited', 'Liteace', 'Logan', 'M3', 'M3 e92', 'M4', 'M5', 'M5 Japan', 'M5 Stoki', 'M550', 'M6', 'ML 250', 'ML 270', 'ML 270 CDI', 'ML 280', 'ML 280 სასწრაფოდ', 'ML 300', 'ML 320', 'ML 320 AMG', 'ML 320 CDI', 'ML 320 DIESEL', 'ML 320 cdi', 'ML 350', 'ML 350 3.7', 'ML 350 350', 'ML 350 370', 'ML 350 4 MATIC', 'ML 350 4matic', 'ML 350 BLUETEC', 'ML 350 Bluetec ', 'ML 350 SPECIAL EDITION', 'ML 350 W164', 'ML 350 sport', 'ML 350 super rexton', 'ML 400', 'ML 500', 'ML 55 AMG', 'ML 550', 'ML 63 AMG', 'MPV', 'Malibu', 'Malibu Hybrid', 'Malibu LT', 'Malibu LTZ', 'Malibu eco', 'March', 'Mark X', 'Mark X Zio', 'Maxima', 'Maxima sv', 'Mazda 2', 'Mazda 3', 'Mazda 3 GRAND TOURING', 'Mazda 3 GT', 'Mazda 3 SPORT', 'Mazda 5', 'Mazda 5 SPORT', 'Mazda 6', 'Mazda 6 GRAND TOURING', 'Mazda 6 Grand Touring', 'Mazda 6 Grand touring', 'Mazda 6 TOURING', 'Megane', 'Megane 1.5CDI', 'Megane 1.9 CDI', 'Megane 1.9CDI', 'Megane GT Line', 'Megane privilege packet', 'Micra <DIESEL>', 'Mira', 'Mirage', 'Mirage 2019', 'Modus', 'Mondeo', 'Montero', 'Montero Sport', 'Murano', 'Mustang', 'Mustang AUT', 'Mustang Premium', 'Mustang cabrio', 'Mustang ecoboost', 'Mustang v6cabrio', 'Mx-5', 'Mx-5 Miata', 'NEW Beetle', 'NX 200', 'NX 300', 'Navara', 'Niro', 'Niva', 'Noah', 'Note', 'Octavia', 'Octavia SCOUT', 'Octavia Scout', 'Odyssey', 'Optima', 'Optima 2.4', 'Optima ECO', 'Optima ECO HYBRID', 'Optima ECOHYBRID', 'Optima EX', 'Optima FULL', 'Optima HYBRID', 'Optima HYBRID ', 'Optima Hybrid', 'Optima LX', 'Optima SX', 'Optima SXL', 'Optima Sxl', 'Optima X', 'Optima eco ', 'Optima ex', 'Optima full', 'Optima hibrid', 'Optima hybid', 'Optima hybrid', 'Optima k5', 'Optima lx', 'Orlando', 'Outback', 'Outback 3.0', 'Outback Limited', 'Outback limited', 'Outback preze', 'Outback prze', 'Outlander', 'Outlander 2.4', 'Outlander ES', 'Outlander SE', 'Outlander SPORT', 'Outlander Sport', 'Outlander sport', 'Outlander xl', 'Outlander სპორტ', 'Paceman', 'Pajero', 'Pajero IO', 'Pajero IO GDI', 'Pajero IO SORENTO', 'Pajero MONTERO', 'Pajero Sport', 'Panamera', 'Partner', 'Passat', 'Passat  B-7 TDI', 'Passat 2.0 tfsi', 'Passat B-8', 'Passat B7', 'Passat D7', 'Passat Limited', 'Passat PREMIUM', 'Passat Premium', 'Passat R-line', 'Passat RLAINI', 'Passat S', 'Passat SE', 'Passat SEL', 'Passat Se', 'Passat TSI', 'Passat b8', 'Passat se', 'Passat sel', 'Passat sport', 'Passat tdi sel', 'Passat tsi', 'Passat tsi-se', 'Pathfinder', 'Pathfinder LE', 'Pathfinder SE', 'Pathfinder SL 4WD', 'Patriot', 'Patriot 70th anniversary', 'Patriot Latitude', 'Patrol', 'Patrol GRX', 'Phaeton', 'Picanto', 'Pilot', 'Polo', 'Presage', 'Pride', 'Prius', 'Prius ....', 'Prius 1.5I', 'Prius 1.8', 'Prius 11', 'Prius 2010', 'Prius 3', 'Prius 9', 'Prius BLUG-IN', 'Prius C', 'Prius C 1.5I', 'Prius C 1.5i', 'Prius C 2013', 'Prius C 80 original', 'Prius C C', 'Prius C Hybrid', 'Prius C Navigation', 'Prius C YARIS IA', 'Prius C aqua', 'Prius C hybrid', 'Prius C nekrashen', 'Prius C ჰიბრიდი', 'Prius Full', 'Prius Hybrid', 'Prius Japan', 'Prius Persona series', 'Prius Plogin', 'Prius Plug IN', 'Prius Plug in', 'Prius Prius', 'Prius S', 'Prius Sport', 'Prius TRIM 5', 'Prius TRIM5', 'Prius TSS LIMITED', 'Prius Trim5', 'Prius V', 'Prius V ALPINA', 'Prius V HIBRID', 'Prius V HYBRID', 'Prius Xsp', 'Prius b', 'Prius hybrid', 'Prius japan', 'Prius personna', 'Prius plagin', 'Prius plug-in', 'Prius s', 'Prius twin 5', 'Prius vw30', 'Prius ახალი', 'Prius მე-2 თაობა', 'Prius ფლაგინი', 'Prius ჯბლ და ჰედაპი', 'Prius ჰეჩბექი', 'Prius ჰიბრიდი', 'Qashqai', 'Qashqai Advance CVT', 'Qashqai SPORT', 'Quest', 'Quest 2016', 'Quest LIMITED', 'R 320', 'R 320 3.0', 'R 350', 'R 350 BLUETEC', 'R 500', 'RAV 4', 'RAV 4 2.0 vvti', 'RAV 4 4DR SPOR', 'RAV 4 Dizel', 'RAV 4 L', 'RAV 4 LIMITED', 'RAV 4 LONG', 'RAV 4 Le', 'RAV 4 Limited ', 'RAV 4 S', 'RAV 4 SPORT', 'RAV 4 XLE', 'RAV 4 XLE Sport', 'RAV 4 hybrid', 'RAV 4 long', 'RAV 4 s p o r t', 'RAV 4 se', 'RC F', 'REXTON', 'REXTON SUPER', 'RIO', 'RIO LX', 'RIO lX', 'RIO lx', 'RIO praid', 'RVR', 'RX 300', 'RX 300 c', 'RX 330', 'RX 350', 'RX 400', 'RX 400 4/4', 'RX 400 H', 'RX 400 HYBRID', 'RX 400 RESTAILING', 'RX 400 hybrid', 'RX 450', 'RX 450 H', 'RX 450 HYBRID', 'RX 450 h', 'RX 450 hibrid', 'Ractis', 'Range Rover', 'Range Rover Evoque', 'Range Rover Evoque 2.0', 'Range Rover SPORT', 'Range Rover VOGUE', 'Range Rover vogue', 'Ranger', 'Rapid', 'Renegade', 'Renegade Trailhawk', 'Ridgeline', 'Rogue', 'Rogue 4x4', 'Rogue SL', 'Rogue SPORT', 'Rogue Sport', 'Routan', 'Routan SEL', 'Rx-8', 'S 320', 'S 320 CDI', 'S 320 DIESEL', 'S 350', 'S 350 CDI 320', 'S 400', 'S 430', 'S 430 4 MATIC', 'S 500', 'S 500 Long', 'S 55', 'S 55 5.5', 'S 550', 'S 550 ჰიბრიდი ', 'S 600', 'S 63 AMG', 'S-max', 'S-type 3.0', 'S-type R', 'SL 55 AMG', 'SLK 200', 'SLK 230', 'SLK 350', 'SLK 350 300', 'SOUL', 'SOUL SXL', 'SX4', 'Samsung QM5', 'Sandero Stepway', 'Santa FE', 'Santa FE SPORT', 'Santa FE Ultimate', 'Santa FE long', 'Santa FE sport', 'Scenic', 'Sentra', 'Sequoia', 'Serena', 'Serena Hibrid', 'Shuttle', 'Sienna', 'Sienta', 'Sienta  LE', 'Silverado', 'Skyline', 'Smart', 'Smart Fortwo', 'Sonata', 'Sonata  blue edition', 'Sonata 2.0t', 'Sonata 2.4L', 'Sonata 2015', 'Sonata ECO', 'Sonata HYBRID', 'Sonata Hibrid', 'Sonata Hv', 'Sonata Hybrid', 'Sonata Hybrid ', 'Sonata LIMITED', 'Sonata LIMITED ', 'Sonata LPG', 'Sonata Limited', 'Sonata S', 'Sonata SE', 'Sonata SE LIMITED', 'Sonata SPORT', 'Sonata Sport', 'Sonata brilianti', 'Sonata hibrid', 'Sonata hybrid', 'Sonata limited', 'Sonata sport', 'Sonata sport ', 'Sonata sport limited', 'Sonata y20', 'Sonata სასწრაფოდ', 'Sonic', 'Sorento', 'Sorento 2.4', 'Sorento EX', 'Sorento EX ', 'Sorento SX', 'Spark', 'Sportage', 'Sportage 4th Gen', 'Sportage EX', 'Sportage PRESTIGE', 'Sportage SX', 'Sportage V6', 'Sprinter', 'Sprinter 00', 'Sprinter 2.2', 'Sprinter 2.7', 'Sprinter 211 CDI', 'Sprinter 213', 'Sprinter 308 CDI', 'Sprinter 311', 'Sprinter 313', 'Sprinter 313 CD', 'Sprinter 313CDI', 'Sprinter 314', 'Sprinter 315', 'Sprinter 315CDI', 'Sprinter 315CDI-XL', 'Sprinter 316', 'Sprinter 316 CDI', 'Sprinter 411', 'Sprinter EURO4', 'Sprinter MAX', 'Sprinter Maxi-ს Max', 'Sprinter VAN', 'Sprinter VIP CLASS', 'Sprinter სატვირთო', 'Sprinter ქირავდება', 'Step Wagon', 'Step Wagon RG2 SPADA', 'Step Wagon SPADA', 'Step Wagon SPADA Z', 'Suburban', 'Super 5', 'Superb', 'Swift', 'T5', 'Tacoma', 'Tahoe', 'Tahoe hybrid', 'Taunus', 'Taurus', 'Taurus X', 'Taurus interceptor', 'Teana', 'Terios', 'Terracan', 'Terrano', 'Tiguan', 'Tiguan SE', 'Tiguan s', 'Tiida', 'Titan', 'Touareg', 'Touareg 3.0 TDI', 'Touran', 'Tourneo Connect', 'Tourneo Connect TREND', 'Tourneo Connect Trend', 'Town and Country', 'Trafic', 'Transit', 'Transit 115', 'Transit 135', 'Transit 2.4', 'Transit 2500', 'Transit 350T', 'Transit 74 TURBO', 'Transit 88 KW', 'Transit Camper', 'Transit Connect', 'Transit Custom', 'Transit Dublkabina', 'Transit L X', 'Transit MAX', 'Transit Maxi', 'Transit S', 'Transit T330', 'Transit Tourneo', 'Transit Transit', 'Transit Trend', 'Transit ford ', 'Transit lux', 'Transit tourneo', 'Transit turbo', 'Transit სასწრაფოდ', 'Traverse', 'Traverse LT', 'Trax', 'Trax 1LT', 'Trax LT', 'Trooper', 'Tucson', 'Tucson 2.0', 'Tucson LIMITED', 'Tucson Limited', 'Tucson SE', 'Tucson Se', 'Tucson TURBO', 'Tucson iX 20', 'Tucson iX-20', 'Tucson ix 20', 'Tucson limitedi', 'Tundra', 'V 230', 'VOXY', 'VOXY 2003', 'Vaneo', 'Veloster', 'Veloster R-spec', 'Veloster TURBO', 'Veloster Turbo', 'Veloster remix', 'Veracruz', 'Versa', 'Versa Note', 'Versa SE', 'Verso', 'Viano', 'Viano 115', 'Viano 115 CDI', 'Viano 2,2', 'Viano 3.2', 'Viano Brabus', 'Viano CD 3.0', 'Viano Long', 'Virage', 'Vitara', 'Vitara GL+', 'Vito', 'Vito 109', 'Vito 110', 'Vito 111', 'Vito 111 CDI', 'Vito 113', 'Vito 115', 'Vito 115 CDI', 'Vito 116', 'Vito 2.2', 'Vito Exstralong', 'Vito Extralong', 'Vito long115', 'Vito nisan urvan', 'Vitz', 'Vitz RS', 'Volt', 'Volt  ', 'Volt 1.4', 'Volt Full Packet', 'Volt PREMIER', 'Volt PREMIUM', 'Volt Premier', 'Volt premier', 'Volt restailingi', 'Voyager', 'Wrangler', 'Wrangler sport', 'X-Terra', 'X-Terra 2010', 'X-Terra SE', 'X-Trail', 'X-Trail 4X4', 'X-Trail LPG', 'X-Trail NISSAN X TRAIL R', 'X-Trail T30', 'X-Trail axis', 'X-Trail ford tranzit', 'X-Trail gt', 'X-Trail რესტაილინგი', 'X1', 'X1 28Xdrive', 'X1 4X4', 'X1 X-Drive', 'X1 XDRAIV', 'X1 xDrive335i', 'X3', 'X3 3.5i', 'X3 BLK/BLK', 'X3 SDRIVE', 'X4', 'X5', 'X5 2007', 'X5 3.0', 'X5 3.0i', 'X5 3.5', 'X5 3.5i', 'X5 30SD', 'X5 350d', 'X5 35D', 'X5 35d', 'X5 4.8is', 'X5 4/4turbo', 'X5 4x4', 'X5 530', 'X5 DIESEL', 'X5 E-70', 'X5 E53', 'X5 E70', 'X5 Japan', 'X5 M', 'X5 M packet ', 'X5 M/S', 'X5 Sport', 'X5 X - drive', 'X5 X-DRIVE', 'X5 X-Drive', 'X5 XDRIVE', 'X5 XDRIVE 35D', 'X5 XDRIVE35I', 'X5 e53', 'X5 panoramic', 'X5 rest', 'X5 restilling', 'X5 x5', 'X5 İA', 'X5 დიზელი', 'X6', 'X6 35i', 'X6 M', 'X6 xDrive 35', 'XF', 'XJ', 'XL7', 'XV', 'XV Crosstrek', 'XV HYBRID', 'XV crosstrek', 'XV krostreki', 'XV limited', 'XV premium', 'Yaris', 'Yaris IA', 'Yaris RS', 'Yaris SE', 'Yaris iA', 'Z4', 'Z4 3,0 SI', 'Z4 3.0', 'i20', 'i3', 'i40', 'kona', 'kona SEL', 'macan', 'Cabriolet', 'Coupe', 'Goods wagon', 'Hatchback', 'Jeep', 'Limousine', 'Microbus', 'Minivan', 'Pickup', 'Sedan', 'Universal', '2000', '2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', 'Automatic', 'Manual', 'Tiptronic', 'Variator', 'price']

# Membuat dataframe kosong dengan nama kolom
normalized_df = pandas.DataFrame(columns=list_fitur)
#normalized_df = pandas.read_csv('data_mobil.csv')

def prepare_data(mileage, manufacture, model, category, year, gear_box_type):
    # Input nilai untuk setiap fitur
    input_value0 = mileage
    input_value1 = str(manufacture)
    input_value2 = str(model)
    input_value3 = str(category)
    input_value4 = str(year)
    input_value5 = str(gear_box_type)

    column_names1 = normalized_df.columns[1:31]  # Nama-nama kolom
    column_names2 = normalized_df.columns[31:1597]
    column_names3 = normalized_df.columns[1597:1608]
    column_names4 = normalized_df.columns[1608:1629]
    column_names5 = normalized_df.columns[1629:1633]

    features = [input_value0] + \
               [1 if col == input_value1 else 0 for col in column_names1] + \
               [1 if col == input_value2 else 0 for col in column_names2] + \
               [1 if col == input_value3 else 0 for col in column_names3] + \
               [1 if col == input_value4 else 0 for col in column_names4] + \
               [1 if col == input_value5 else 0 for col in column_names5]

    return features

def predict(x):
    scaler = MinMaxScaler()
    data_predict = scaler.fit_transform([x])
    predictions = model.predict(data_predict)
    return predictions.tolist()

app = Flask(__name__)

@app.route("/", methods=["POST"])
def index():
    if request.method == "POST":
        try:
            input_data = request.get_json()
            if not input_data:
                return jsonify({"error": "no data"})

            feature1 = input_data.get('feature1')
            feature2 = input_data.get('feature2')
            feature3 = input_data.get('feature3')
            feature4 = input_data.get('feature4')
            feature5 = input_data.get('feature5')
            feature6 = input_data.get('feature6')
            features = prepare_data(feature1, feature2, feature3, feature4, feature5, feature6)
            prediction = predict(features)

            data = {"prediction": prediction}
            return jsonify(data)
        except Exception as e:
            return jsonify({"error": str(e)})
    return "OK"

if __name__ == "__main__":
    keras.utils.get_custom_objects().update({'RSquared': RSquared})
    model = keras.models.load_model("model-mobil.h5")  # Load the model inside the custom object scope
    app.run(debug=True)
